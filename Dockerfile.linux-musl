FROM --platform=$BUILDPLATFORM tonistiigi/xx AS xx

FROM --platform=$BUILDPLATFORM alpine

COPY --from=xx / /

RUN apk add cmake clang lld bash build-base

WORKDIR /nativebinaries
COPY . /nativebinaries/

ARG TARGETPLATFORM
RUN xx-apk add musl-dev gcc pkgconf

RUN xx-info env
RUN xx-clang --setup-target-triple

CMD ["/bin/bash", "-c", "./build.libgit2.sh"]